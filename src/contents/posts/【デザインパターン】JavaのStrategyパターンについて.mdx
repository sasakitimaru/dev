---
title: ã€ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³ã€‘Javaã®Strategyãƒ‘ã‚¿ãƒ¼ãƒ³ã«ã¤ã„ã¦
slug: design-pattern/java-strategy-pattern
icon: â˜•ï¸
description: ä»Šå›ã¯Javaã®Strategyãƒ‘ã‚¿ãƒ¼ãƒ³ã«ã¤ã„ã¦ç´¹ä»‹ã—ã¾ã™ã€‚
date: "2023-09-23"
tags:
  - Java
  - ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³
categories:
  - ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°
---

## Strategy

Strategy=æˆ¦ç•¥ã€€ã§ã™ã€‚
ã“ã®ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã¯æˆ¦ç•¥ã«å½“ãŸã‚‹éƒ¨åˆ†ï¼ˆ=ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ï¼‰ã‚’åˆ†é›¢ã—ã¦è‰²ã€…ãªæˆ¦ç•¥ã‚’ãƒ¡ã‚¤ãƒ³ã®å®Ÿè£…ã«é–¢ã‚ã‚‰ãšå¤‰æ›´ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã‚‚ã®ã§ã™ã€‚

## å®Ÿè£…

ä»Šå›ã¯ãƒã‚±ãƒ¢ãƒ³ãƒãƒˆãƒ«ã‚’å†ç¾ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚

### Pokemon

ã„ããªã‚Šé•·ã„ã‚³ãƒ¼ãƒ‰ã§ã™ãŒã€ã“ã“ã§ã¯ãƒã‚±ãƒ¢ãƒ³ã®åŸºæœ¬çš„ãªæƒ…å ±ã¨ãã‚Œã‚’ç”¨ã„ãŸå‡¦ç†ã‚’è¨˜è¿°ã—ã¾ã™ã€‚
ã¾ãŸã€[Singletonãƒ‘ã‚¿ãƒ¼ãƒ³](https://kurimatsugpt.com/posts/design-pattern/java-singleton-pattern)ã‚’æ¡ç”¨ã—ã¦ãŠã‚Šã€å„ãƒã‚±ãƒ¢ãƒ³ã¯å¿…ãšä¸€ä½“ã—ã‹å­˜åœ¨ã—ã¾ã›ã‚“ã€‚ï¼ˆç°¡å˜ã®ãŸã‚ã“ã®ã‚ˆã†ãªè¨­è¨ˆã¨ã—ã¦ã„ã¾ã™ã€‚ï¼‰

```java:java
public enum Pokemon {
    IVYSAUR(Type.GRASS, 60, 62, 63, 80, 80, 60),
    CHARIZARD(Type.FIRE, 78, 84, 78, 109, 85, 100),
    SQUIRTLE(Type.WATER, 44, 48, 65, 50, 64, 43),
    SQUIRT(Type.WATER, 40, 48, 50, 55, 60, 45),
    TANGLEA(Type.GRASS, 65, 55, 115, 100, 40, 60),
    MAGMAR(Type.FIRE, 65, 95, 57, 100, 85, 93);

    private final Type type;
    private int hp;
    private final int atk;
    private final int def;
    private final int spAtk;
    private final int spDef;
    private final int spd;

    Pokemon(Type type, int hp, int atk, int def, int spAtk, int spDef, int spd) {
        this.type = type;
        this.hp = hp;
        this.atk = atk;
        this.def = def;
        this.spAtk = spAtk;
        this.spDef = spDef;
        this.spd = spd;
    }

    public int getHp() {
        return this.hp;
    }

    public boolean isGreaterDef(Pokemon pokemon) {
        return this.def > pokemon.def;
    }

    public boolean isSuperEffective(Pokemon pokemon) {
        return this.type.isSuperEffectiveType(pokemon.type);
    }

    public boolean isWeak(Pokemon pokemon) {
        return this.type.isWeakType(pokemon.type);
    }

    public boolean willMoveFirst(Pokemon opponent) {
        if (this.spd > opponent.spd) {
            return true;
        } else if (this.spd < opponent.spd) {
            return false;
        } else {
            return Math.random() < 0.5;
        }
    }

    public void processDamage(Pokemon opponent, boolean shouldPhysicalAttack) {
        int baseDamage = calculateDamage(opponent, shouldPhysicalAttack);
        setDamage(opponent, baseDamage);
    }

    public int calculateDamage(Pokemon opponent, boolean shouldPhysicalAttack) {
        double usedAtk = shouldPhysicalAttack ? this.atk : this.spAtk;
        double usedDef = shouldPhysicalAttack ? opponent.def : opponent.spDef;
        double baseDamage = (usedAtk / usedDef) * 10;

        if (this.isSuperEffective(opponent)) {
            baseDamage *= 2.0;
            System.out.println("It's super effective!");
        } else if (this.isWeak(opponent)) {
            System.out.println("It's not very effective...");
            baseDamage *= 0.5;
        }
        return (int) baseDamage;
    }

    private void setDamage(Pokemon opponent, int damage) {
        opponent.hp = Math.max(opponent.hp - damage, 0);
    }
}
```

### Strategy

æˆ¦ç•¥ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’å®Ÿè£…ã—ã¦ã„ãã¾ã™ã€‚
ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã«ã—ã¦ã„ã‚‹ç†ç”±ã¯ã€
ã©ã®ã‚ˆã†ãªæˆ¦ç•¥ã‚’ä½¿ã†ã‹ã ã‘å®šç¾©ã—ã¦ã„ã¾ã™ã€‚
ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’å®Ÿè£…ã—ãŸã‚¯ãƒ©ã‚¹ã§å…·ä½“çš„ãªæˆ¦ç•¥ã¯è¨˜è¿°ã—ã¾ã™ã€‚

```java:java
import java.util.List;

public interface Strategy {
    public boolean shouldAttackPhysically(Pokemon targetPokemon, Pokemon currentBattlingPokemon);
    public boolean shouldChangePokemon(Pokemon targetPokemon, Pokemon currentBattlingPokemon);
    public Pokemon WhoShouldPickForNext(Pokemon targetPokemon, List<Pokemon> myPokemon);
}
```

### SmartStrategy

Strategyã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®å®Ÿè£…ã‚¯ãƒ©ã‚¹ã§ã™ã€‚
Pokemonå‹ã®ä¸­ã«ã‚ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ã£ã¦ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®å„ªåŠ£ã‚’è¨ˆç®—ã—ã¦ãã®çµæœã‚’åˆ©ç”¨ã—ã¦æ”»æ’ƒã€ãƒã‚±ãƒ¢ãƒ³äº¤æ›ã‚’ã©ã†ã™ã‚‹ã‹æˆ¦ç•¥ã‚’è€ƒãˆã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚

```java:java
import java.util.ArrayList;
import java.util.List;
import java.util.Random;

public class SmartStrategy implements Strategy {
    public SmartStrategy() {
    }

    @Override
    public boolean shouldAttackPhysically(Pokemon targetPokemon, Pokemon currentBattlingPokemon) {
        return currentBattlingPokemon.isGreaterDef(targetPokemon);
    }

    @Override
    public boolean shouldChangePokemon(Pokemon targetPokemon, Pokemon currentBattlingPokemon) {
        return currentBattlingPokemon.isWeak(targetPokemon);
    }

    @Override
    public Pokemon WhoShouldPickForNext(Pokemon targetPokemon, List<Pokemon> myPokemon) {
        List<Pokemon> advantageous = new ArrayList<>();
        List<Pokemon> neutral = new ArrayList<>();
        List<Pokemon> disadvantageous = new ArrayList<>();

        for (Pokemon pokemon : myPokemon) {
            if (pokemon.isSuperEffective(targetPokemon)) {
                advantageous.add(pokemon);
            } else if (pokemon.isWeak(targetPokemon)) {
                disadvantageous.add(pokemon);
            } else {
                neutral.add(pokemon);
            }
        }

        if (!advantageous.isEmpty()) {
            return getRandomPokemon(advantageous);
        } else if (!neutral.isEmpty()) {
            return getRandomPokemon(neutral);
        } else {
            return getRandomPokemon(disadvantageous);
        }
    }

    private Pokemon getRandomPokemon(List<Pokemon> pokemonList) {
        Random rand = new Random();
        return pokemonList.get(rand.nextInt(pokemonList.size()));
    }
}
```

### NormalStrategy

ã“ã¡ã‚‰ã¯æˆ¦ç•¥ã¯ãƒ©ãƒ³ãƒ€ãƒ ã«æ±ºå®šã™ã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚
SmartStrategyã¨ã®å¯¾æ¯”ç”¨ã§ã™ã€‚å¼±ã„NPCã€‚

```java:java
import java.util.List;
import java.util.Random;

public class NormalStrategy implements Strategy {
    private final Random random;
    public NormalStrategy() {
        this.random = new Random();
    }
    @Override
    public boolean shouldChangePokemon(Pokemon targetPokemon, Pokemon currentBattlingPokemon) {
        return random.nextInt() % 4 == 0;
    }

    @Override
    public boolean shouldAttackPhysically(Pokemon targetPokemon, Pokemon currentBattlingPokemon) {
        return random.nextInt() % 2 == 0;
    }
    @Override
    public Pokemon WhoShouldPickForNext(Pokemon targetPokemon, List<Pokemon> myPokemon) {
        return myPokemon.get(random.nextInt(myPokemon.size()));
    }
}
```

### Trainer

å®Ÿéš›ã«ãƒã‚±ãƒ¢ãƒ³ãƒãƒˆãƒ«ã‚’è¡Œã†ãƒˆãƒ¬ãƒ¼ãƒŠãƒ¼ã‚¯ãƒ©ã‚¹ã§ã™ã€‚
ä¸Šè¨˜ã§å®Ÿè£…ã—ãŸæˆ¦ç•¥ã‚’ç”¨ã„ã¦ã‚¿ãƒ¼ãƒ³åˆ¶ã®ãƒãƒˆãƒ«ã‚’è¡Œã„ã¾ã™ã€‚
ãƒˆãƒ¬ãƒ¼ãƒŠãƒ¼ã«ã¯æ‰‹æŒã¡ã®ãƒã‚±ãƒ¢ãƒ³ãŒä¸ãˆã‚‰ã‚Œã€ãã®ãƒã‚±ãƒ¢ãƒ³ã‚’å…ƒã«ä¸ãˆã‚‰ã‚ŒãŸæˆ¦ç•¥ã‚’åˆ©ç”¨ã—ã¦æˆ¦ã†ã‚¤ãƒ¡ãƒ¼ã‚¸ã§ã™ã€‚

```java:java
import java.util.List;

public class Trainer {
    private Strategy strategy;
    private List<Pokemon> myPokemon;
    private Pokemon battlePokemon;
    private int changePokemonCount = 0;
    private Trainer opponentTrainer;
    private Pokemon targetPokemon;

    public Trainer(Strategy strategy, List<Pokemon> myPokemon) {
        this.strategy = strategy;
        this.myPokemon = myPokemon;
        this.battlePokemon = myPokemon.get(0);
    }
    public void setOpponentTrainer(Trainer opponentTrainer) {
        this.opponentTrainer = opponentTrainer;
        this.targetPokemon = opponentTrainer.battlePokemon;
    }
    private void setChangePokemonCount(int changePokemonCount) {
        this.changePokemonCount = changePokemonCount;
    }
    public boolean isNextPlayer() {
        return battlePokemon.willMoveFirst(targetPokemon);
    }
    public void turn() {
        turnStart();
        battle();
        turnEnd();
    }

    public void turnStart() {
        System.out.println("------Turn start------");
        System.out.println("Trainer " + this + " is playing");
    }

    public void battle() {
        if (strategy.shouldChangePokemon(targetPokemon, battlePokemon)) {
            changePokemon();
        } else {
            attack();
        }
    }
    public void turnEnd() {
        if (targetPokemon.getHp() <= 0) {
            processOpponentPokemonDefeated();
        }
        System.out.println("-----Turn end-----");
    }
    public void processOpponentPokemonDefeated() {
        opponentTrainer.removeDownedPokemon();
        if(opponentTrainer.myPokemon.isEmpty()) {
            System.out.println("Trainer " + opponentTrainer + " has no more Pokemon left!");
            System.out.println("Trainer " + this.strategy.toString() + " wins!");
            System.exit(0);
        }
        opponentTrainer.setChangePokemonCount(0);
        opponentTrainer.changePokemon();
        targetPokemon = opponentTrainer.battlePokemon;
    }
    private void attack () {
        System.out.println("Target Pokemon: " + targetPokemon);
        System.out.println("My Pokemon: " + battlePokemon);
        System.out.println("TARGET HP: " + targetPokemon.getHp());
        boolean result = strategy.shouldAttackPhysically(targetPokemon, battlePokemon);
        battlePokemon.processDamage(targetPokemon, result);
        System.out.println("TARGET HP: " + targetPokemon.getHp());
    }
    private void changePokemon() {
        if (changePokemonCount == 0) {
            battlePokemon = strategy.WhoShouldPickForNext(targetPokemon, myPokemon);
            System.out.println("Trainer " + this + " changed Pokemon to " + battlePokemon);
            changePokemonCount++;
        } else {
            attack();
            changePokemonCount = 0;
        }
    }
    private void removeDownedPokemon() {
        myPokemon.removeIf(pokemon -> pokemon.getHp() <= 0);
        System.out.println("Trainer " + this + " has " + myPokemon.size() + " Pokemon left!");
    }
}
```

## å®Ÿè¡Œ

### Mainã‚¯ãƒ©ã‚¹

ãã‚Œãã‚Œã®æ‰‹æŒã¡ã®ãƒã‚±ãƒ¢ãƒ³ã‚’Listã§ä½œã‚Šã¾ã™ã€‚
ãã®å¾Œæˆ¦ç•¥ã‚’ä½œæˆã—ã€ãƒˆãƒ¬ãƒ¼ãƒŠãƒ¼ã«ãƒã‚±ãƒ¢ãƒ³ã¨æˆ¦ç•¥ã‚’ãã‚Œãã‚Œä¸ãˆã‚‹ã“ã¨ã§æº–å‚™å®Œäº†ã§ã™ã€‚
ã‚ã¨ã¯ãƒãƒˆãƒ«ã‚’ç¹°ã‚Šè¿”ã™ã“ã¨ãŒã§ãã¾ã™ã€‚
æ›¸ã„ã¦ã¿ã‚‹ã¨ã‚ã‹ã‚‹é€šã‚Šã€æˆ¦ç•¥ãŒç¶ºéº—ã«åˆ†é›¢ã•ã‚Œã¦ã„ã¾ã™ã€‚
ã“ã‚Œã®ãŠã‹ã’ã§ã€æ–°ã—ã„æˆ¦ç•¥ã‚’å®Ÿè£…ã—ãŸã¨ã—ã¦ã‚‚ã™ãã«é©ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

```java:java
import java.util.ArrayList;
import java.util.List;

public class Main {
    public static void main(String[] args) {
        List<Pokemon> smartTrainersPokemon = new ArrayList<>();
        smartTrainersPokemon.add(Pokemon.SQUIRT);
        smartTrainersPokemon.add(Pokemon.CHARIZARD);
        smartTrainersPokemon.add(Pokemon.IVYSAUR);

        List<Pokemon> normalTrainersPokemon = new ArrayList<>();
        normalTrainersPokemon.add(Pokemon.MAGMAR);
        normalTrainersPokemon.add(Pokemon.TANGLEA);
        normalTrainersPokemon.add(Pokemon.SQUIRTLE);

        Strategy smartStrategy = new SmartStrategy();
        Strategy normalStrategy = new NormalStrategy();

        Trainer smartTrainer = new Trainer(smartStrategy, smartTrainersPokemon);
        Trainer normalTrainer = new Trainer(normalStrategy, normalTrainersPokemon);

        smartTrainer.setOpponentTrainer(normalTrainer);
        normalTrainer.setOpponentTrainer(smartTrainer);

        while (true) {
            if (smartTrainer.isNextPlayer()) {
                smartTrainer.turn();
                normalTrainer.turn();
            } else {
                normalTrainer.turn();
                smartTrainer.turn();
            }
        }
    }
}
```

ã¡ãªã¿ã«ã€ãƒã‚±ãƒ¢ãƒ³ã¯ãã‚Œãã‚Œã®ãƒˆãƒ¬ãƒ¼ãƒŠãƒ¼ã§åˆ¥ã®ã‚‚ã®ã‚’æŒãŸã›ãªã‘ã‚Œã°ãªã‚Šã¾ã›ã‚“ã€‚
åŒã˜ã®ã‚’æŒãŸã›ã‚‹ã¨æ®‹ã‚ŠHPãªã©ã‚’å…±æœ‰ã—ã¦ã—ã¾ã„ã¾ã™ï¼ˆSingletonã®ãŸã‚ï¼‰
å®Ÿéš›ã«ã¯ã€ãƒã‚±ãƒ¢ãƒ³ã‚¯ãƒ©ã‚¹ã¯åˆ¥ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰ãƒã‚±ãƒ¢ãƒ³ã‚’å‚ç…§ã—ã¦å–ã‚Šè¾¼ã¿ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã—ã¦ã‹ã‚‰ãƒˆãƒ¬ãƒ¼ãƒŠãƒ¼ã®æ‰‹æŒã¡ã«ä¸ãˆã‚‹ã¹ãã§ã—ã‚‡ã†ã€‚ç¹°ã‚Šè¿”ã—ã¾ã™ãŒä»Šå›ã¯ç°¡å˜ã®ãŸã‚ä¸‹è¨˜ã®è¨­è¨ˆã«ãªã‚Šã¾ã™ã€‚

å®Ÿè¡Œçµæœ

```
------Turn start------
Trainer strategy.Trainer@e9e54c2 is playing
Target Pokemon: SQUIRT
My Pokemon: MAGMAR
TARGET HP: 40
It's not very effective...
TARGET HP: 32
-----Turn end-----
------Turn start------
Trainer strategy.Trainer@3b07d329 is playing
Target Pokemon: MAGMAR
My Pokemon: SQUIRT
TARGET HP: 65
It's super effective!
TARGET HP: 53
-----Turn end-----
------Turn start------
Trainer strategy.Trainer@e9e54c2 is playing
Target Pokemon: SQUIRT
My Pokemon: MAGMAR
TARGET HP: 32
It's not very effective...
TARGET HP: 23
-----Turn end-----

~çœç•¥~

------Turn start------
Trainer strategy.Trainer@e9e54c2 is playing
Target Pokemon: CHARIZARD
My Pokemon: SQUIRTLE
TARGET HP: 47
It's super effective!
TARGET HP: 35
-----Turn end-----
------Turn start------
Trainer strategy.Trainer@3b07d329 is playing
Target Pokemon: SQUIRTLE
My Pokemon: IVYSAUR
TARGET HP: 13
It's super effective!
TARGET HP: 0
Trainer strategy.Trainer@e9e54c2 has 0 Pokemon left!
Trainer strategy.Trainer@e9e54c2 has no more Pokemon left!
Trainer strategy.SmartStrategy@16b98e56 wins!
```

See you later ğŸ‘‹