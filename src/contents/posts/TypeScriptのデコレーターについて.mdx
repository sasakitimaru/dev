---

title: TypeScriptã®ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ãƒ¼ã«ã¤ã„ã¦
slug: typescript_decorator
icon: ğŸ€
description: 
date: "2023-10-07"
tags:

- TypeScript

categories:

- ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°

---

ä»¥å‰ç´¹ä»‹ã—ãŸ[decoratorãƒ‘ã‚¿ãƒ¼ãƒ³](https://www.kurimatsugpt.com/posts/design-pattern/java-decorator-pattern)ãŒé©ç”¨ã•ã‚Œã¦ã„ã‚‹TypeScriptã®æ§‹æ–‡ã§ã™ã€‚
Nest.jsã¨ã‹ã§ã‚ˆãå‡ºã¦ãã¾ã™ã€‚

ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨ã—ã¦ä½¿ã‚ã‚Œã¦ã„ã‚‹ã‚¢ãƒ¬ã§ã™ã€‚
@Controllerã€€â†ã“ã‚Œ

â†“ã®è¨˜äº‹ã‚’èª­ã‚“ã§ã€è‡ªåˆ†ã®é ­ã˜ã‚ƒè¶³ã‚Šã¦ãªã‹ã£ãŸéƒ¨åˆ†ã®è£œè¶³ãƒ¡ãƒ¢ã«ãªã‚‹ã®ã§ãœã²ã“ã¡ã‚‰ã‚’èª­ã‚“ã§ã¿ã¦ãã ã•ã„ã€‚

[ã‚‚ã†æ€–ããªã„TypeScriptã®Decoratoræ©Ÿèƒ½](https://zenn.dev/miruoon_892/articles/365675fa5343ed)

ã»ã¼è¨˜äº‹ã®å†…å®¹é€šã‚Šã§ã™ãŒ[å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://www.typescriptlang.org/docs/handbook/decorators.html)è¦‹ã¦å°‘ã—ã ã‘ä»Šé¢¨ã®æ›¸ãæ–¹ã«å¤‰ãˆã¦ã¾ã™ã€‚

## ã‚¯ãƒ©ã‚¹ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ãƒ¼

ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã§ãƒ‡ã‚³ãƒ¬ãƒ¼ãƒˆã•ã‚ŒãŸã‚¯ãƒ©ã‚¹ã«hello()ã¨ã„ã†ãƒ¡ã‚½ãƒƒãƒ‰ã‚’è¿½åŠ ã™ã‚‹ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ãƒ¼ã§ã™ã€‚
å®Ÿæ…‹ã¯ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚’å¼•æ•°ã«å–ã‚Šã€ãã®ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ã«ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä»˜åŠ ã™ã‚‹voidé–¢æ•°ã§ã™ã€‚

```tsx:tsx
type Constructor<T> = new (...args: any[]) => T;
function BaseEntity<T>(ctr: Constructor<T>) {
  ctr.prototype.hello = () => {
    console.log('hello', ctr.name);
  };
}

@BaseEntity
class Cat {
  public name = 'mei';
  constructor() {
    console.log('cat');
  }
}

@BaseEntity
class Dog {
  public name = 'dog';
  constructor() {
    console.log('dog');
  }
}

const cat = new Cat();
const dog = new Dog();

// eslintã‚¨ãƒ©ãƒ¼ã‚’é˜²ãç”¨ã€ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ãƒ¼ã«ã‚ˆã‚‹å‹å®šç¾©ã¯TSã®ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã«ä¼ã‚ã£ã¦ã„ãªã„
// eslint-disable-next-line @typescript-eslint/ban-ts-comment
// @ts-ignore
cat.hello();
// eslint-disable-next-line @typescript-eslint/ban-ts-comment
// @ts-ignore
dog.hello();
```

**`BaseEntity`**é–¢æ•°ã®**`T`**ã¯**`Cat`**ã‚¯ãƒ©ã‚¹ã®å‹ã«ãªã‚Šã¾ã™ã€‚ã“ã‚Œã¯TypeScriptã®å‹æ¨è«–ã®ä¸€éƒ¨ã¨ã—ã¦è‡ªå‹•çš„ã«è¡Œã‚ã‚Œã¾ã™ã€‚

## ãƒ¡ã‚½ãƒƒãƒ‰ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ãƒ¼

å…ˆã»ã©å¼•ç”¨ã—ãŸè¨˜äº‹ã®è£œè¶³ã‚’è¿½åŠ ã—ã¦ã„ã‚‹ã ã‘ã§ã™ã€‚

```tsx:tsx
function checkCalculate(num: number) {
  return function (target: any, propertyKey: string, descriptor: PropertyDescriptor) {
		// descriptor.valueã¯ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å¯¾è±¡ã®ãƒ¡ã‚½ãƒƒãƒ‰
    const addFunc = descriptor.value;
    descriptor.value = function (...args: number[]) {
			// applyãƒ¡ã‚½ãƒƒãƒ‰ã§Caluculateã‚¯ãƒ©ã‚¹ï¼ˆthisï¼‰ã®
			// sumãƒ¡ã‚½ãƒƒãƒ‰ï¼ˆdescriptor.valueï¼‰ã‚’å®Ÿè¡Œ
      const result = addFunc.apply(this, args);
      // å…ƒãƒ¡ã‚½ãƒƒãƒ‰ã®è¿”å´å€¤ãŒ10æœªæº€ã®ã¨ãã¯ã€æ›ã‘ç®—ã‚’å®Ÿè¡Œã™ã‚‹
      return result < 10 ? result * num : result;
    };
  };
}

class Calculate {
  @checkCalculate(10)
  sum(a: number, b: number): number {
    return a + b;
  }
}

// 50 -> 1 + 4 = 5ã‚’å®Ÿè¡Œã—ãŸå¾Œã«ã€5 < 10ã ã£ãŸãŸã‚æ›´ã«5 x 10 = 50ã‚’è¿”ã™
console.log(new Calculate().sum(1, 4));
// 21 -> 20 + 1 = 21ã‚’å®Ÿè¡Œã—ãŸå¾Œã«ã€21 > 10ã ã£ãŸãŸã‚ã€æ›ã‘ç®—ã¯å®Ÿè¡Œã›ãšãã®ã¾ã¾21ã‚’è¿”ã™
console.log(new Calculate().sum(20, 1));
```

returnã—ã¦ã„ã‚‹functionãŒã‚„ã£ã¦ã„ã‚‹ã“ã¨ï¼š
sumãƒ¡ã‚½ãƒƒãƒ‰ã‚’å—ã‘å–ã‚Šã€ãã®å‡¦ç†ã‚’ä¸‹è¨˜ã®é€šã‚Šä¸Šæ›¸ãã™ã‚‹ã€‚

```
sumã®çµæœãŒ10æœªæº€ã®æ™‚ã ã‘æ›ã‘ç®—ã‚’å®Ÿè¡Œã™ã‚‹
```

## ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ãƒ¼

ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«ã™ã‚‰ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãŒå¯èƒ½ã§ã™ã€‚
ä¸‹è¨˜ã®é€šã‚ŠPersonã‚¯ãƒ©ã‚¹ã®nameãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«ã¯meiã¨ã„ã†å€¤ãŒä¸ãˆã‚‰ã‚Œã¦ã„ã¾ã™ãŒãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ãƒ¼ã§å‡¦ç†ã‚’ãƒ©ãƒƒãƒ—ã™ã‚‹ã“ã¨ã§å¿…ãškurimatsuã—ã‹è¿”ã£ã¦ã“ãªã„ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

get, setã¯å¼•æ•°ã«ã‚ã‚‹propertyNameã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’å¤‰æ›´ã‹å–å¾—ã—ã‚ˆã†ã¨ã—ãŸéš›ã®å‡¦ç†ã‚’è¡¨ã—ã¾ã™ã€‚

ã¾ãŸã€targetã«ã¯Personã‚¯ãƒ©ã‚¹ã®ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ï¼ˆã‚¯ãƒ©ã‚¹ã®å‚ç…§ï¼‰ã‚’è¡¨ã—ã¾ã™ã€‚

```tsx:tsx
function ChangeToKurimatsu(target: any, propertyName: string) {
  let value = target[propertyName];
  Object.defineProperty(target, propertyName, {
    get: () => 'kurimatsu',
    set: () => {
      value = 'kurimatsu';
    },
  });
}

class Person {
  @ChangeToKurimatsu
  public name = 'mei';
}
```

## ã¾ã¨ã‚

ä»Šå›ã¯ãƒ¡ã‚¸ãƒ£ãƒ¼ãª3ã¤ã‚’ç´¹ä»‹ã—ã¾ã—ãŸãŒä»–ã«ã‚‚è§¦ã‚Œã¦ã„ãªã„éƒ¨åˆ†ã¯ãŸãã•ã‚“ã‚ã‚‹ã®ã§æ°—ã«ãªã‚‹æ–¹ã¯ãœã²å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚ç…§ã—ã¦ã¿ã¦ãã ã•ã„ã€‚

See you later ğŸ‘‹