---
title: ã€ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³ã€‘Javaã®Visitorãƒ‘ã‚¿ãƒ¼ãƒ³ã«ã¤ã„ã¦
slug: design-pattern/java-visitor-pattern
icon: â˜•ï¸
description: ä»Šå›ã¯visitorãƒ‘ã‚¿ãƒ¼ãƒ³ã«ã¤ã„ã¦è§£èª¬ã—ã¾ã™ã€‚
date: "2023-09-26"
tags:
    - Java
    - ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³
categories:
    - ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°
---

## Visitor

å‡¦ç†ã¨å®Ÿæ…‹ã‚’åˆ†é›¢ã—ã¦è€ƒãˆã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã™ã€‚
ãƒ‡ãƒªãƒ˜ãƒ«ã®ä¾‹ã§è€ƒãˆã¦ã¿ã¾ã™ï¼ˆã“ã‚Œã—ã‹æ€ã„ã¤ã‹ã‚“ï¼‰
ãƒ‡ãƒªãƒ˜ãƒ«ãŒVisitorã€å¾…æ©Ÿã—ã¦ã„ã‚‹äººãŒå®Ÿæ…‹ã§ã™ã€‚
ãƒ‡ãƒªãƒ˜ãƒ«å´ã«ã‚‚ã•ã¾ã–ã¾ãªãƒ—ãƒ¬ã‚¤ãŒå­˜åœ¨ã—ã€å„å®¶ã‚’å›ã‚ŠãªãŒã‚‰ãã®å‡¦ç†ã‚’æ–½ã—ã¦ã„ãã¾ã™ã€‚
ã‚‚ã¡ã‚ã‚“å¾…æ©Ÿã—ã¦ã„ã‚‹äººã¯ç”·ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã—ã€å¥³ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚
ãã‚Œãã‚Œã«åˆã‚ã›ãŸãƒ—ãƒ¬ã‚¤ãŒå­˜åœ¨ã—ã¾ã™ã€‚
ã“ã‚Œã‚‰ã®å‡¦ç†ã‚’åˆ†é›¢ã—ã¦å„å®¶ã‚’å¾ªç’°ã—ã¦å›ã‚‹ã€ã¨ã„ã†æ§‹é€ ã«ãªã‚Šã¾ã™ã€‚
ã—ã‚‡ã†ã‚‚ãªã„è©±ã¯ç½®ã„ã¦ãŠã„ã¦å®Ÿè£…ã«ç§»ã‚Šã¾ã—ã‚‡ã†ã€‚

## å®Ÿè£…

ä»Šå›ã¯[Compositeãƒ‘ã‚¿ãƒ¼ãƒ³](https://www.kurimatsugpt.com/posts/design-pattern/java-composite-pattern)ã®æ™‚ã«ç”¨ã„ãŸã‚³ãƒ¡ãƒ³ãƒˆæ©Ÿèƒ½ã‚’åˆ†é›¢ã—ã¦ã„ãã¾ã™ã€‚

### Visitor

Visitorã‚¯ãƒ©ã‚¹ã¯è¨ªå•å…ˆã®ã‚¯ãƒ©ã‚¹ã«ä¾å­˜ã—ã¦ã„ã¾ã™ã€‚
ã“ã“ã§ã¯ã¾ã æŠ½è±¡çš„ãªè¨ªå•è€…ã§ã™ã€‚
ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰ã—ã¦ã‚³ãƒ¡ãƒ³ãƒˆã€ãƒªãƒ—ãƒ©ã‚¤ãŒãã‚Œãã‚Œæ¸¡ã•ã‚ŒãŸéš›ã®å‡¦ç†ã‚’ã‚µãƒ–ã‚¯ãƒ©ã‚¹ã§å®Ÿè£…ã—ã¾ã™ã€‚

```java:java
public abstract class Visitor {
    public abstract void visit(Comment comment);
    public abstract void visit(Reply reply);
}
```

### ListVisitor

å…·ä½“çš„ãªè¨ªå•è€…ã§ã™ã€‚
ã‚³ãƒ¡ãƒ³ãƒˆã‚’ä¸€ã¤ã‚‚ã‚‰ã£ãŸã‚‰ãã®ã‚³ãƒ¡ãƒ³ãƒˆã®ä¸­èº«ã‚’å†èµ·çš„ã«èª¿ã¹ã¦å‡ºåŠ›ã™ã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚
ã‚³ãƒ¡ãƒ³ãƒˆã€ãƒªãƒ—ãƒ©ã‚¤ã‚¯ãƒ©ã‚¹ãŒæŒã£ã¦ã„ã‚‹å‡¦ç†ã¯å¾Œã»ã©å®Ÿè£…ã—ã¾ã™ã€‚

```java:java
public class ListVisitor extends Visitor {
    @Override
    public void visit(Comment comment) {
        if (comment.depth == 0) System.out.println(comment);
        else System.out.println(comment.getIndent() + "|-" + comment);
        for (Conversation cv : comment) {
            cv.accept(this);
        }
    }

    @Override
    public void visit(Reply reply) {
        System.out.println(reply.getIndent() + "|-" + reply);
    }
}
```

### Element

è¨ªå•è€…ã‚’å—ã‘å…¥ã‚Œã‚‹äººã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã§ã™ã€‚
ã‚ã¨ã§è¨˜è¼‰ã™ã‚‹Conversationã‚¯ãƒ©ã‚¹ã«acceptãƒ¡ã‚½ãƒƒãƒ‰ã‚’è¿½åŠ ã—ã¦ã‚‚ã„ã„ã§ã™ãŒã€Elementã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’ä½œã‚Šãã‚Œã‚’å®Ÿè£…ã™ã‚‹ã“ã¨ã§Visitorã®å—ã‘å…¥ã‚Œå…ˆã§ã‚ã‚‹ã“ã¨ã‚’æ˜è¨˜ã—ã¾ã™ã€‚

```java:java
public interface Element {
    public void accept(Visitor visitor);
}
```

### Conversation

Compositeãƒ‘ã‚¿ãƒ¼ãƒ³ã§ç”¨ã„ãŸã‚‚ã®ã¨ã»ã¼åŒã˜ã§ã™ã€‚
ã‚µãƒ–ã‚¯ãƒ©ã‚¹ã§ã‚³ãƒ¡ãƒ³ãƒˆã¨ãƒªãƒ—ãƒ©ã‚¤ã‚’å®Ÿè£…ã—ã¾ã™ã€‚
ãã‚Œãã‚ŒãŒå…±é€šã—ã¦æŒã¤`ã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆã®æ·±ã•`ã‚’ã“ã“ã§å®Ÿè£…ã—ã¾ã™ã€‚
ã¾ãŸã€å…ˆã»ã©ã®Elementã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’å®Ÿè£…ã™ã‚‹ã“ã¨ã§å—ã‘å…¥ã‚Œå…ˆã§ã‚ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚
ã‚µãƒ–ã‚¯ãƒ©ã‚¹ã§acceptãƒ¡ã‚½ãƒƒãƒ‰ã¯å®Ÿè£…ã—ã¾ã™ã€‚

```java:java
public abstract class Conversation implements Element {
    protected int depth = 0;

    protected String getIndent() {
        char[] chars = new char[depth * 4];
        java.util.Arrays.fill(chars, ' ');
        return new String(chars);
    }
}
```

### Comment

Compositeãƒ‘ã‚¿ãƒ¼ãƒ³ã®ã‚‚ã®ã¨ã»ã¼åŒã˜ã§ã™ãŒã€ã“ã“ã«ã¯ã‚³ãƒ¡ãƒ³ãƒˆã¨ã„ã†å®Ÿæ…‹ã ã‘ã‚’æ®‹ã—å…·ä½“çš„ãªå‡¦ç†ã¯æ¥è¨ªè€…ï¼ˆVisitor)ãŒè¡Œãªã£ã¦ã„ãã‚ˆã†ã«å¤‰ãˆã¦ã„ã¾ã™ã€‚
acceptã§æ¥è¨ªè€…ã‚’å—ã‘å…¥ã‚Œã¦å‡¦ç†ã‚’ä»»ã›ã¾ã™ã€‚
ã©ã‚“ãªå‡¦ç†ã‚’ã™ã‚‹æ¥è¨ªè€…ãªã®ã‹ã¯ã“ã®ã‚¯ãƒ©ã‚¹ã¯çŸ¥ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
ã¾ãŸã€å‡¦ç†ã‚’å¤–å´ã§è¡Œã„ã‚„ã™ã„ã‚ˆã†ã«[Iteratorãƒ‘ã‚¿ãƒ¼ãƒ³](https://www.kurimatsugpt.com/posts/design-pattern/java-iterator)ã‚’ä½¿ç”¨ã—ã¦ã‚³ãƒ¡ãƒ³ãƒˆå‹ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ç›´æ¥foræ–‡ã§å›ã›ã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚

```java:java
import java.util.*;

public class Comment extends Conversation implements Iterable<Conversation> {
    private final String comment;
    private final List<Conversation> conversations = new ArrayList<>();
    public Comment(String comment) {
        this.comment = comment;
    }

    public void add(Conversation cv) {
        cv.depth = this.depth + 1;
        this.conversations.add(cv);
    }
    @Override
    public void accept(Visitor v) {
        v.visit(this);
    }
    @Override
    public Iterator<Conversation> iterator() {
        return conversations.iterator();
    }
    @Override
    public String toString() {
        return this.comment;
    }
}
```

### Reply

ã“ã¡ã‚‰ã‚‚Compositeãƒ‘ã‚¿ãƒ¼ãƒ³ã®ã‚‚ã®ã¨ã»ã¼åŒã˜ã§ã™ã€‚
ã‚³ãƒ¡ãƒ³ãƒˆã¨ã„ã†å®¹å™¨ã®ä¸­ã«å­˜åœ¨ã™ã‚‹ã‚‚ã®ã§ã™ã€‚

```java:java
public class Reply extends Conversation {
    private String comment;
    public Reply(String comment) {
        this.comment = comment;
    }
    @Override
    public void accept(Visitor visitor) {
        visitor.visit(this);
    }
    @Override
    public String toString() {
        return this.comment;
    }
}
```

## å®Ÿè¡Œ

### Main

```java:java
public class Main {
    public static void main(String[] args) {
        Comment c1 = new Comment("ã“ã‚“ã«ã¡ã¯");
        c1.add(new Reply("ã¯ã˜ã‚ã¾ã—ã¦"));
        c1.add(new Reply("ã“ã‚“ã«ã¡ã¯ï¼"));
        Comment c1_1 = new Comment("åå‰ã‚’æ•™ãˆã¦ãã ã•ã„");
        c1.add(c1_1);
        c1_1.add(new Reply("ç§ã¯æ —æ¾ã§ã™"));
        Comment c1_2 = new Comment("ç§ã‚‚æ —æ¾ã§ã™");
        c1_1.add(c1_2);
        c1_2.add(new Reply("ã‚ˆã‚ã—ããŠé¡˜ã„ã—ã¾ã™"));
        Visitor v = new ListVisitor();
        c1.accept(v);
    }
}
```

å®Ÿè¡Œçµæœ

```
ã“ã‚“ã«ã¡ã¯
    |-ã¯ã˜ã‚ã¾ã—ã¦
    |-ã“ã‚“ã«ã¡ã¯ï¼
    |-åå‰ã‚’æ•™ãˆã¦ãã ã•ã„
        |-ç§ã¯æ —æ¾ã§ã™
        |-ç§ã‚‚æ —æ¾ã§ã™
            |-ã‚ˆã‚ã—ããŠé¡˜ã„ã—ã¾ã™
```

Compositeãƒ‘ã‚¿ãƒ¼ãƒ³ã¨æ›ã‘åˆã‚ã›ã‚‹ã“ã¨ã§ã€å†èµ·çš„ãªå‡¦ç†ã‚’ã‚·ãƒ³ãƒ—ãƒ«ã«å®Ÿè£…ã§ãã‹ã¤ã€å…·ä½“çš„ãªå‡¦ç†ã¯Visitorã«å§”ã­ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã€‚
ä¸Šè¨˜ã«æ–°ã—ã„Visitorã€ä¾‹ãˆã°ã‚³ãƒ¡ãƒ³ãƒˆå…¨ä½“ã®å®¹é‡ã‚’èª¿ã¹ã‚‹å‡¦ç†ã‚’è¿½åŠ ã—ãŸã„å ´åˆã¯æ–°ãŸã«CaluculateVisitorã‚’ä½œã‚‹ã ã‘ã§ç°¡å˜ã«ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã¯ãšã§ã™ã€‚

See you later ğŸ‘‹